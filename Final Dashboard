<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jal-Drishti - AI-Powered Water-Logging Risk Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #map {
            height: 500px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .risk-high {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: white;
        }

        .risk-medium {
            background: linear-gradient(135deg, #f6e05e, #ecc94b);
            color: #744210;
        }

        .risk-low {
            background: linear-gradient(135deg, #68d391, #48bb78);
            color: white;
        }

        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .notification-badge {
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .sidebar-item:hover {
            transform: translateX(5px);
            transition: all 0.3s ease;
        }

        .action-card {
            transition: all 0.3s ease;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="min-h-screen bg-gray-50">
        <!-- Header -->
        <header class="glass-effect shadow-lg sticky top-0 z-50">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <i class="fas fa-water text-3xl text-blue-600"></i>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                                Jal-Drishti Dashboard
                            </h1>
                            <p class="text-sm text-gray-600">AI-Powered Water-Logging Risk Management System</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="relative notification-badge">
                            <i class="fas fa-bell text-xl text-gray-600 cursor-pointer"></i>
                            <span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full px-2">3</span>
                        </div>
                        <button class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-4 py-2 rounded-lg hover:shadow-lg transition">
                            <i class="fas fa-plus mr-2"></i>Report Issue
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="container mx-auto px-4 py-6">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="glass-effect rounded-xl p-4 action-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Total Wards</p>
                            <p class="text-2xl font-bold">6</p>
                        </div>
                        <i class="fas fa-map-marked-alt text-3xl text-blue-500"></i>
                    </div>
                </div>
                <div class="glass-effect rounded-xl p-4 action-card risk-high">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">High Risk</p>
                            <p class="text-2xl font-bold">2</p>
                        </div>
                        <i class="fas fa-exclamation-triangle text-3xl animate-pulse-slow"></i>
                    </div>
                </div>
                <div class="glass-effect rounded-xl p-4 action-card risk-medium">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-700 text-sm">Medium Risk</p>
                            <p class="text-2xl font-bold">2</p>
                        </div>
                        <i class="fas fa-exclamation-circle text-3xl"></i>
                    </div>
                </div>
                <div class="glass-effect rounded-xl p-4 action-card risk-low">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">Low Risk</p>
                            <p class="text-2xl font-bold">2</p>
                        </div>
                        <i class="fas fa-check-circle text-3xl"></i>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Main Map Section -->
                <div class="lg:col-span-2">
                    <div class="glass-effect rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-gray-800">Ward-Wise Risk Map</h2>
                            <div class="flex space-x-2">
                                <button onclick="refreshMap()" class="px-3 py-1 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition">
                                    <i class="fas fa-sync-alt mr-1"></i>Refresh
                                </button>
                                <button class="px-3 py-1 bg-purple-100 text-purple-600 rounded-lg hover:bg-purple-200 transition">
                                    <i class="fas fa-filter mr-1"></i>Filter
                                </button>
                            </div>
                        </div>
                        <div id="map"></div>
                        <div class="mt-4 flex items-center justify-center space-x-6">
                            <div class="flex items-center">
                                <span class="status-indicator bg-red-500 mr-2"></span>
                                <span class="text-sm text-gray-600">High Risk</span>
                            </div>
                            <div class="flex items-center">
                                <span class="status-indicator bg-yellow-500 mr-2"></span>
                                <span class="text-sm text-gray-600">Medium Risk</span>
                            </div>
                            <div class="flex items-center">
                                <span class="status-indicator bg-green-500 mr-2"></span>
                                <span class="text-sm text-gray-600">Low Risk</span>
                            </div>
                        </div>
                    </div>

                    <!-- AI Predictions Section -->
                    <div class="glass-effect rounded-xl p-6 mt-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">AI Risk Predictions</h2>
                        <canvas id="predictionsChart"></canvas>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Live Updates -->
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-broadcast-tower text-red-500 mr-2"></i>
                            Live Updates
                        </h3>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            <div class="sidebar-item bg-red-50 border-l-4 border-red-500 p-3 rounded cursor-pointer" onclick="showWardDetails('Jahangirpuri', 'C-2025-0001', 'Bad', 1195, 'Blockage')">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-semibold text-red-800">Jahangirpuri</p>
                                        <p class="text-xs text-gray-600">Drainage blockage - Bad status</p>
                                    </div>
                                    <span class="text-xs bg-red-500 text-white px-2 py-1 rounded">Active</span>
                                </div>
                            </div>
                            <div class="sidebar-item bg-red-50 border-l-4 border-red-500 p-3 rounded cursor-pointer" onclick="showWardDetails('Burari', 'C-2025-0002', 'Bad', 1180, 'Overflow')">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-semibold text-red-800">Burari</p>
                                        <p class="text-xs text-gray-600">Drain overflow detected</p>
                                    </div>
                                    <span class="text-xs bg-red-500 text-white px-2 py-1 rounded">Active</span>
                                </div>
                            </div>
                            <div class="sidebar-item bg-yellow-50 border-l-4 border-yellow-500 p-3 rounded cursor-pointer" onclick="showWardDetails('Karol Bagh', 'C-2025-0004', 'Average', 1065, 'Blockage')">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-semibold text-yellow-800">Karol Bagh</p>
                                        <p class="text-xs text-gray-600">Moderate risk - Blockage reported</p>
                                    </div>
                                    <span class="text-xs bg-yellow-500 text-white px-2 py-1 rounded">Monitor</span>
                                </div>
                            </div>
                            <div class="sidebar-item bg-yellow-50 border-l-4 border-yellow-500 p-3 rounded cursor-pointer" onclick="showWardDetails('Najafgarh', 'C-2025-0005', 'Average', 985, 'Blockage')">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-semibold text-yellow-800">Najafgarh</p>
                                        <p class="text-xs text-gray-600">Average drainage - Blockage issue</p>
                                    </div>
                                    <span class="text-xs bg-yellow-500 text-white px-2 py-1 rounded">Monitor</span>
                                </div>
                            </div>
                            <div class="sidebar-item bg-green-50 border-l-4 border-green-500 p-3 rounded cursor-pointer">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-semibold text-green-800">Dwarka-B</p>
                                        <p class="text-xs text-gray-600">Good drainage status</p>
                                    </div>
                                    <span class="text-xs bg-green-500 text-white px-2 py-1 rounded">Normal</span>
                                </div>
                            </div>
                            <div class="sidebar-item bg-green-50 border-l-4 border-green-500 p-3 rounded cursor-pointer">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-semibold text-green-800">Greater Kailash</p>
                                        <p class="text-xs text-gray-600">Good drainage status</p>
                                    </div>
                                    <span class="text-xs bg-green-500 text-white px-2 py-1 rounded">Normal</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recommended Actions -->
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-tasks text-purple-500 mr-2"></i>
                            AI Recommended Actions
                        </h3>
                        <div class="space-y-3">
                            <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-lg border-l-4 border-purple-500">
                                <p class="font-semibold text-purple-800">Immediate: Deploy pumps</p>
                                <p class="text-sm text-gray-600">Jahangirpuri, Burari - Critical drainage failure</p>
                                <button class="mt-2 text-xs bg-purple-600 text-white px-3 py-1 rounded-full hover:bg-purple-700">
                                    Take Action
                                </button>
                            </div>
                            <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-4 rounded-lg border-l-4 border-blue-500">
                                <p class="font-semibold text-blue-800">Preventive: Clean drains</p>
                                <p class="text-sm text-gray-600">Karol Bagh, Najafgarh - Average status needs maintenance</p>
                                <button class="mt-2 text-xs bg-blue-600 text-white px-3 py-1 rounded-full hover:bg-blue-700">
                                    Schedule
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Citizen Reports -->
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-users text-green-500 mr-2"></i>
                            Recent Citizen Reports
                        </h3>
                        <div class="space-y-3">
                            <div class="flex items-start space-x-3">
                                <img src="https://ui-avatars.com/api/?name=R&background=random" class="w-8 h-8 rounded-full">
                                <div class="flex-1">
                                    <p class="text-sm font-semibold">Resident</p>
                                    <p class="text-xs text-gray-600">Heavy water accumulation after rain</p>
                                    <p class="text-xs text-gray-400">Jahangirpuri • 5 min ago</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <img src="https://ui-avatars.com/api/?name=C&background=random" class="w-8 h-8 rounded-full">
                                <div class="flex-1">
                                    <p class="text-sm font-semibold">Citizen</p>
                                    <p class="text-xs text-gray-600">Drain overflow in residential area</p>
                                    <p class="text-xs text-gray-400">Burari • 12 min ago</p>
                                </div>
                            </div>
                        </div>
                        <button onclick="openReportModal()" class="w-full mt-4 bg-gradient-to-r from-green-500 to-teal-500 text-white py-2 rounded-lg hover:shadow-lg transition">
                            <i class="fas fa-plus-circle mr-2"></i>Submit Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Modal -->
    <div id="reportModal" class="modal">
        <div class="modal-content bg-white rounded-xl p-6 max-w-md mx-auto mt-20">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold">Report Water-Logging Issue</h3>
                <button onclick="closeReportModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="submitReport(event)">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                    <input type="text" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter ward or area name" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Severity</label>
                    <select class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                        <option value="low">Low - Minor accumulation</option>
                        <option value="medium">Medium - Traffic affected</option>
                        <option value="high">High - Major flooding</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Describe the issue..." required></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Upload Image (Optional)</label>
                    <input type="file" accept="image/*" class="w-full">
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-2 rounded-lg hover:shadow-lg transition">
                    Submit Report
                </button>
            </form>
        </div>
    </div>

    <script>
        // Initialize Map
        let map;
        let markers = [];

        function initMap() {
            map = L.map('map').setView([28.6139, 77.2090], 11);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            // Add ward markers with actual data from dataset
            const wards = [
                {name: "Jahangirpuri", lat: 28.7253, lng: 77.1624, risk: "high", status: "Bad", issueType: "Blockage", rainfall: 1195, complaintId: "C-2025-0001", alert: "Red", drainage: "Bad"},
                {name: "Burari", lat: 28.7487, lng: 77.2000, risk: "high", status: "Bad", issueType: "Overflow", rainfall: 1180, complaintId: "C-2025-0002", alert: "Red", drainage: "Bad"},
                {name: "Karol Bagh", lat: 28.6512, lng: 77.1903, risk: "medium", status: "Average", issueType: "Blockage", rainfall: 1065, complaintId: "C-2025-0004", alert: "Yellow", drainage: "Average"},
                {name: "Najafgarh", lat: 28.6096, lng: 76.9855, risk: "medium", status: "Average", issueType: "Blockage", rainfall: 985, complaintId: "C-2025-0005", alert: "Yellow", drainage: "Average"},
                {name: "Dwarka-B", lat: 28.5921, lng: 77.0460, risk: "low", status: "Good", issueType: "Overflow", rainfall: 940, complaintId: "C-2025-0006", alert: "Green", drainage: "Good"},
                {name: "Greater Kailash", lat: 28.5494, lng: 77.2425, risk: "low", status: "Good", issueType: "Overflow", rainfall: 925, complaintId: "C-2025-0003", alert: "Green", drainage: "Good"}
            ];

            wards.forEach(ward => {
                let color = ward.risk === 'high' ? '#ef4444' : ward.risk === 'medium' ? '#f59e0b' : '#10b981';
                let icon = L.divIcon({
                    html: `<div style="background: ${color}; width: 30px; height: 30px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>`,
                    iconSize: [30, 30],
                    className: 'custom-div-icon'
                });
                
                let marker = L.marker([ward.lat, ward.lng], {icon: icon})
                    .addTo(map)
                    .bindPopup(`
                        <div style="padding: 10px; min-width: 200px;">
                            <h4 style="font-weight: bold; margin-bottom: 8px; font-size: 16px;">${ward.name}</h4>
                            <p style="margin: 3px 0; font-size: 13px;"><strong>Alert:</strong> <span style="color: ${color}; font-weight: bold;">${ward.alert}</span></p>
                            <p style="margin: 3px 0; font-size: 13px;"><strong>Drainage:</strong> ${ward.drainage}</p>
                            <p style="margin: 3px 0; font-size: 13px;"><strong>Issue:</strong> ${ward.issueType}</p>
                            <p style="margin: 3px 0; font-size: 13px;"><strong>Rainfall:</strong> ${ward.rainfall}mm</p>
                            <p style="margin: 3px 0; font-size: 12px; color: #666;"><strong>ID:</strong> ${ward.complaintId}</p>
                            <button onclick="showWardDetails('${ward.name}', '${ward.complaintId}', '${ward.drainage}', ${ward.rainfall}, '${ward.issueType}')" style="background: #6366f1; color: white; padding: 6px 12px; border-radius: 5px; border: none; cursor: pointer; margin-top: 8px; width: 100%;">View Details</button>
                        </div>
                    `);
                markers.push(marker);
            });
        }

        // Initialize Predictions Chart
        function initPredictionsChart() {
            const ctx = document.getElementById('predictionsChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['June', 'July', 'August', 'September', 'October'],
                    datasets: [{
                        label: 'High Risk Wards',
                        data: [8, 15, 22, 18, 12],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Medium Risk Wards',
                        data: [12, 18, 25, 22, 16],
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Low Risk Wards',
                        data: [180, 167, 153, 160, 172],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'AI Predicted Risk Levels (Monsoon 2024)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Modal Functions
        function openReportModal() {
            document.getElementById('reportModal').style.display = 'block';
        }

        function closeReportModal() {
            document.getElementById('reportModal').style.display = 'none';
        }

        function submitReport(event) {
            event.preventDefault();
            alert('Report submitted successfully! Our AI system will analyze and take appropriate action.');
            closeReportModal();
        }

        function showWardDetails(wardName, complaintId, drainage, rainfall, issueType) {
            const riskLevel = drainage === 'Bad' ? 'High' : drainage === 'Average' ? 'Medium' : 'Low';
            const drainageCapacity = drainage === 'Bad' ? '40%' : drainage === 'Average' ? '60%' : '85%';
            
            alert(`Ward: ${wardName}\n\nComplaint ID: ${complaintId}\n\nAI Analysis:\n- Current Risk: ${riskLevel}\n- Drainage Status: ${drainage}\n- Drainage Capacity: ${drainageCapacity}\n- Average Monsoon Rainfall: ${rainfall}mm\n- Current Issue Type: ${issueType}\n- Recommended Action: ${drainage === 'Bad' ? 'Deploy emergency pumps immediately' : drainage === 'Average' ? 'Schedule preventive maintenance' : 'Continue monitoring'}\n\nClick OK to view full report.`);
        }

        function refreshMap() {
            // Simulate data refresh
            alert('Map data refreshed! All ward statuses updated.');
            // In real implementation, this would fetch new data from backend
        }

        // Initialize everything when page loads
        window.onload = function() {
            initMap();
            initPredictionsChart();
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('reportModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // Simulate real-time updates
        setInterval(() => {
            const updates = document.querySelector('.max-h-96');
            const randomUpdate = Math.random();
            
            if (randomUpdate > 0.7) {
                console.log('New update received from AI system');
                // In real implementation, this would receive data from WebSocket/API
            }
        }, 30000);
    </script>
</body>
</html>
